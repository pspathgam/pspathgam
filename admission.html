<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Pethgam Wagoora Admission Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        input:focus, select:focus, textarea:focus { border-color: #4f46e5; box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5); outline: none; }
        
        /* Print Styles */
        @media print {
            .no-print, .register-view-container { display: none !important; }
            .print-area { box-shadow: none !important; padding: 0 !important; margin: 0 !important; max-width: none !important; }
            .form-section { break-inside: avoid-page; }
            .for-office-use-section { page-break-before: always; }
            h2, h3, h4 { color: #000 !important; -webkit-print-color-adjust: exact; color-adjust: exact; }
            .for-office-use { background-color: #f0f0f0 !important; -webkit-print-color-adjust: exact; color-adjust: exact; }
            .header-content { border-bottom: 2px solid #000 !important; padding-bottom: 1rem; }
            .logo-img { display: block !important; }
            /* Ensure the uploaded photo is visible and framed */
            #photo-box-display { border: 2px solid black !important; background-color: white !important; padding: 0; }
            #photo-box-display img { display: block !important; width: 100% !important; height: 100% !important; object-fit: cover; }
            .photo-upload-container { display: none !important; } /* Hide the upload button when printing */
        }
        
        /* Photo display box for both online and print */
        #photo-box-display {
            border: 4px dashed #9ca3af;
            height: 120px; /* Standard passport photo height */
            width: 100%;
            max-width: 120px; /* Ensure a proper ratio */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.75rem;
            color: #6b7280;
            background-color: #f9fafb;
            margin-left: auto;
            overflow: hidden; /* To handle image fitting */
        }

        #photo-box-display img {
            display: none; /* Hidden until an image is loaded */
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Container for the upload button (online only) */
        .photo-upload-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <!-- Loading Spinner / Error Display -->
    <div id="loading-spinner" class="text-center p-20 text-indigo-600 font-semibold">
        <svg class="animate-spin h-8 w-8 text-indigo-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="mt-4" id="loading-message">Initializing application and connecting to database...</p>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="hidden max-w-5xl mx-auto space-y-8">
        
        <!-- Control for Register View Only -->
        <div class="no-print bg-white p-4 rounded-xl shadow-lg border border-indigo-100 flex justify-end">
            <button onclick="window.toggleView()" id="toggle-view-button" class="py-2 px-4 rounded-lg shadow-md text-indigo-800 bg-indigo-200 hover:bg-indigo-300 transition font-semibold">
                View Admission Register (Records)
            </button>
        </div>
        
        <!-- Admission Form View -->
        <div id="form-view-container" class="bg-white p-6 sm:p-8 lg:p-10 rounded-2xl shadow-2xl print-area border border-gray-200">
            <header class="text-center mb-8 flex flex-col sm:flex-row justify-center items-center header-content">
                <!-- Logo -->
                <img 
                    src="https://placehold.co/60x60/4f46e5/ffffff?text=GPS" 
                    alt="School Logo" 
                    class="h-14 w-14 object-cover rounded-full mr-0 sm:mr-4 mb-3 sm:mb-0 logo-img"
                    onerror="this.onerror=null;this.src='https://placehold.co/60x60/4f46e5/ffffff?text=GPS';"
                >
                
                <div class="text-center">
                    <h2 class="text-2xl sm:text-3xl font-extrabold text-indigo-700 mb-1">ADMISSION FORM</h2>
                    <h3 class="text-lg font-medium text-gray-600">GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h3>
                    <p class="text-xs text-gray-500 mt-1">Wagoora Babareshi Road Near Zonal Education Office Wagoora | UDISE Code: 01022202207</p>
                </div>
            </header>

            <form id="admissionForm" class="space-y-8">
                
                <section class="space-y-6 form-section">
                    <h4 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">I. Student Details</h4>

                    <div class="grid gap-6 sm:grid-cols-4">
                        <!-- Photo Upload & Display -->
                        <div class="sm:col-span-1 flex flex-col items-center justify-start row-span-3 order-last sm:order-none space-y-3">
                            <div id="photo-box-display" class="rounded-lg shadow-inner">
                                <img id="student-photo-preview" src="" alt="Student Photo Preview" class="hidden">
                                <span id="photo-text">Photo (1.5" x 1.5")</span>
                            </div>
                            <div class="photo-upload-container no-print w-full max-w-xs">
                                <label for="photo-upload" class="cursor-pointer bg-indigo-500 hover:bg-indigo-600 text-white text-xs font-semibold py-2 px-3 rounded-lg shadow-md transition duration-150 ease-in-out block text-center w-full">
                                    Upload Student Photo
                                </label>
                                <input type="file" id="photo-upload" accept="image/*" class="hidden" onchange="window.handlePhotoUpload(event)">
                            </div>
                            <input type="hidden" id="photo-base64"> <!-- Hidden field to store Base64 data -->
                        </div>

                        <!-- First Row -->
                        <div class="sm:col-span-1"><label for="s_first" class="block text-sm font-medium text-gray-700">Student First Name *</label><input type="text" id="s_first" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div class="sm:col-span-1"><label for="s_middle" class="block text-sm font-medium text-gray-700">Middle Name</label><input type="text" id="s_middle" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div class="sm:col-span-1"><label for="s_last" class="block text-sm font-medium text-gray-700">Last Name *</label><input type="text" id="s_last" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        
                        <!-- Second Row -->
                        <div class="sm:col-span-1"><label for="aadhaar_name" class="block text-sm font-medium text-gray-700">Name as per Aadhaar *</label><input type="text" id="aadhaar_name" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div class="sm:col-span-1"><label for="aadhaar" class="block text-sm font-medium text-gray-700">Aadhaar Number *</label><input type="text" id="aadhaar" required inputmode="numeric" pattern="[0-9]{12}" title="Aadhaar must be 12 digits" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div class="sm:col-span-1"><label for="dob" class="block text-sm font-medium text-gray-700">Date of Birth *</label><input type="date" id="dob" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        
                        <!-- Third Row -->
                        <div class="sm:col-span-1">
                            <label for="category" class="block text-sm font-medium text-gray-700">Category *</label>
                            <select id="category" required class="mt-1 block w-full p-3 border border-gray-300 bg-white rounded-lg">
                                <option value="">Select Category</option><option>GENERAL</option><option>OBC</option><option>SC</option><option>ST</option>
                            </select>
                        </div>
                        <div class="sm:col-span-1">
                            <label for="blood" class="block text-sm font-medium text-gray-700">Blood Group *</label>
                            <select id="blood" required class="mt-1 block w-full p-3 border border-gray-300 bg-white rounded-lg">
                                <option value="">Select Group</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                            </select>
                        </div>
                        <div class="sm:col-span-1"><label for="ration" class="block text-sm font-medium text-gray-700">Ration Card Number *</label><input type="text" id="ration" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                    </div>

                    <!-- Fourth Row - below photo section -->
                    <div class="grid gap-6 sm:grid-cols-4">
                        <div class="sm:col-span-1">
                            <label for="class_join" class="block text-sm font-medium text-gray-700">Class Joining *</label>
                            <select id="class_join" required class="mt-1 block w-full p-3 border border-gray-300 bg-white rounded-lg">
                                <option value="">Select Class</option>
                                <option value="Pre Primary 3">Pre Primary 3</option>
                                <option value="Pre Primary 2">Pre Primary 2</option>
                                <option value="Balvatika">Balvatika</option>
                                <option value="1st">1st</option>
                                <option value="2nd">2nd</option>
                                <option value="3rd">3rd</option>
                                <option value="4th">4th</option>
                                <option value="5th">5th</option>
                            </select>
                        </div>
                        <div class="sm:col-span-1"><label for="father_name" class="block text-sm font-medium text-gray-700">Father's Name *</label><input type="text" id="father_name" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div class="sm:col-span-1"><label for="mother_name" class="block text-sm font-medium text-gray-700">Mother's Name *</label><input type="text" id="mother_name" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div class="sm:col-span-1"></div> <!-- Empty spacer -->
                    </div>

                    <div class="grid gap-6 sm:grid-cols-2">
                        <div><label for="fcontact" class="block text-sm font-medium text-gray-700">Father Contact *</label><input type="tel" id="fcontact" required inputmode="tel" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div><label for="mcontact" class="block text-sm font-medium text-gray-700">Mother Contact *</label><input type="tel" id="mcontact" required inputmode="tel" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                    </div>

                    <div><label for="residence" class="block text-sm font-medium text-gray-700">Residence (Full Address) *</label><input type="text" id="residence" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                    <div class="grid gap-6 sm:grid-cols-2">
                        <div><label for="tehsil" class="block text-sm font-medium text-gray-700">Tehsil *</label><input type="text" id="tehsil" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div><label for="district" class="block text-sm font-medium text-gray-700">District *</label><input type="text" id="district" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                    </div>
                </section>
                
                <section class="space-y-6 form-section">
                    <h4 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">II. Bank Details</h4>
                    
                    <div><label for="bank_account" class="block text-sm font-medium text-gray-700">Bank Account Number</label><input type="text" id="bank_account" inputmode="numeric" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                    
                    <div class="grid gap-6 sm:grid-cols-3">
                        <div><label for="bank_name" class="block text-sm font-medium text-gray-700">Bank Name</label><input type="text" id="bank_name" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                        <div><label for="ifsc" class="block text-sm font-medium text-gray-700">IFSC Code</label><input type="text" id="ifsc" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg uppercase"></div>
                    </div>
                    
                    <div><label for="pen" class="block text-sm font-medium text-gray-700">PEN Number (If Transferring)</label><input type="text" id="pen" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg"></div>
                </section>
                
                <section class="space-y-6 border border-red-200 p-6 rounded-xl bg-red-50 form-section">
                    <h4 class="text-xl font-semibold text-red-800 border-b pb-2 mb-4">III. Parent's Declaration</h4>
                    
                    <!-- UPDATED DECLARATION TEXT START -->
                    <p class="text-sm text-gray-700">
                        I do hereby declare that the above information provided by me is true to the best of my knowledge and belief. 
                        I further declare that I will abide by the rules and regulations laid down by the school and the department 
                        from time to time and I will co-operate with the institution for the betterment of my ward and institution 
                        under rules when sought. I hereby declare that as the Parent of above mentioned student am giving my consent 
                        to provide the AADHAAR for the demographic authentication of the student.
                    </p>
                    <!-- UPDATED DECLARATION TEXT END -->

                    <div class="space-y-3">
                        <div class="flex items-center"><input id="declare_info" name="declaration" type="checkbox" required class="h-4 w-4 text-indigo-600 border-gray-300 rounded"><label for="declare_info" class="ml-3 text-sm font-medium text-gray-700">I confirm and consent to the above declaration. *</label></div>
                        <div class="flex items-center"><input id="declare_rules" name="declaration" type="checkbox" required class="h-4 w-4 text-indigo-600 border-gray-300 rounded"><label for="declare_rules" class="ml-3 text-sm font-medium text-gray-700">I agree to abide by the school rules. *</label></div>
                    </div>

                    <div class="grid grid-cols-2 gap-6 pt-4">
                        <div><label for="declaration_date" class="block text-sm font-medium text-gray-700">Date</label><input type="date" id="declaration_date" class="mt-1 block w-full p-3 border-b border-gray-400 bg-transparent rounded-none" required></div>
                        <div><label for="parent_signature" class="block text-sm font-medium text-gray-700">Parent/Guardian Full Name (Signature Placeholder)</label><input type="text" id="parent_signature" class="mt-1 block w-full p-3 border-b border-gray-400 bg-transparent rounded-none" required placeholder="Type Name as Signature"></div>
                    </div>
                </section>

                <!-- SUBMIT AND DOWNLOAD BUTTONS -->
                <div class="no-print">
                    <button type="submit" id="submit-button" class="w-full py-4 px-6 rounded-lg shadow-xl text-xl font-bold text-white bg-indigo-600 hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                        Final Online Application Submission
                    </button>
                    <!-- Button for printing pre-filled form (using browser native print-to-PDF) -->
                    <button type="button" onclick="window.print()" class="w-full mt-4 py-3 px-6 rounded-lg shadow-md text-lg font-bold text-green-700 border border-green-700 bg-green-50 hover:bg-green-100 transition duration-150 ease-in-out">
                        Print/Save Pre-filled Form (as PDF)
                    </button>
                </div>
                
                <div id="message-box" class="hidden p-4 mt-4 text-sm rounded-lg border-2" role="alert"></div>

                <!-- FOR OFFICE USE ONLY -->
                <section class="space-y-6 p-6 sm:p-8 rounded-xl border-4 border-dashed border-gray-300 bg-gray-100 for-office-use for-office-use-section form-section">
                    <h4 class="text-xl font-extrabold text-gray-900 border-b-4 border-gray-400 pb-2 mb-4 text-center tracking-wider">V. FOR OFFICE USE ONLY</h4>
                    
                    <div class="grid gap-6 sm:grid-cols-3">
                        <div><label for="admission_number" class="block text-sm font-medium text-gray-700">Admission Number</label><input type="text" id="admission_number" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg bg-white"></div>
                        <div><label for="date_admission" class="block text-sm font-medium text-gray-700">Date of Admission Granted</label><input type="date" id="date_admission" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg bg-white"></div>
                        <div><label for="verified_by" class="block text-sm font-medium text-gray-700">Verified By</label><input type="text" id="verified_by" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg bg-white"></div>
                    </div>

                    <div>
                        <label for="documents_submitted" class="block text-sm font-medium text-gray-700">Documents Submitted (Checklist)</label>
                        <textarea id="documents_submitted" rows="4" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg bg-white">
- Birth Certificate: Yes / No
- Aadhaar Copy: Yes / No
- Ration Card Copy: Yes / No
- Previous School TC: Yes / No
                        </textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6 pt-4 border-t border-gray-300">
                         <div><p class="text-sm font-medium text-gray-700 mb-2">Signature of Admin Incharge:</p><div class="h-12 border-b border-gray-500 bg-white"></div></div>
                        <div><p class="text-sm font-medium text-gray-700 mb-2">
