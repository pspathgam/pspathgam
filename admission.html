<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admission Management - GPS Pethgam Wagoora</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    /* --- GENERAL STYLES --- */
    body{
        font-family: Arial, sans-serif;
        background:#eef7ff;
        margin:0;
        padding:20px;
    }
    .tab-buttons{
        display:flex;
        gap:10px;
        margin-bottom:20px;
        justify-content: center;
    }
    .tab-buttons button{
        background:#0b76ef;
        color:white;
        padding:10px 22px;
        border:none;
        border-radius:6px;
        font-weight:bold;
        cursor:pointer;
        box-shadow:0px 4px 0px #064a97;
        transition:0.1s;
    }
    .tab-buttons button.active {
        background: #004d99;
        box-shadow:0px 2px 0px #064a97;
    }
    .tab-buttons button:active{
        box-shadow:0px 1px 0px #064a97;
        transform:translateY(3px);
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .container{
        background:white;
        padding:20px;
        border-radius:8px;
        box-shadow:0px 0px 10px #bcd4ff;
        max-width:850px; 
        margin:auto;
    }
    /* --- HEADER STYLES --- */
    .header-content {
        display: flex; align-items: center; justify-content: center; 
        margin-bottom: 20px; text-align: center; border-bottom: 2px solid #ccc;
        padding-bottom: 15px;
    }
    .school-logo {
        height: 80px; width: 80px; margin-right: 20px; border: 1px solid #ccc; 
        display: flex; align-items: center; justify-content: center;
        border-radius: 50%; font-size: 10px; color: #555; font-weight: bold;
    }
    h2{ margin-top:0; margin-bottom: 5px; font-size: 24px; color: #0b76ef; }
    .header-text p { margin: 0; font-size: 12px; color: #555; }
    /* --- FORM STYLES --- */
    label{ display:block; margin-top:10px; font-weight:bold; }
    .form-row { display: flex; gap: 15px; margin-bottom: 10px; }
    .form-group { flex: 1; min-width: 0; }
    .form-group label { margin-top: 0; font-size: 14px; font-weight: normal; }
    input, select{
        width:100%; padding:8px; margin-top:5px; border-radius:4px;
        border:1px solid #999; box-sizing: border-box;
    }
    .section-title{
        font-size:18px; margin-top:25px; font-weight:bold; 
        text-decoration:underline; color: #0b76ef;
    }
    /* --- BUTTON STYLES --- */
    .submit-btn, #openApaarForm {
        background:#28a745; color:white; padding:12px; border:none; 
        border-radius:6px; width:48%; font-size:18px; margin-top:20px;
        cursor:pointer; font-weight:bold; box-shadow:0px 4px 0px #0c6c25;
        transition:0.1s;
    }
    #openApaarForm {
        background:#0b76ef;
        box-shadow:0px 4px 0px #064a97;
    }
    .form-actions {
        display: flex;
        justify-content: space-between;
        gap: 10px;
    }
    .action-buttons {
        display: flex; gap: 10px; margin-top: 20px; justify-content: center;
    }
    .pdf-btn {
        background:#dc3545; color:white; padding:10px 15px; border:none;
        border-radius:6px; font-weight:bold; cursor:pointer;
        box-shadow:0px 4px 0px #970617; transition:0.1s; font-size: 16px;
        flex-grow: 1; max-width: 250px;
    }
    /* --- TEMPLATE STYLES for PDF Print (Issue 2, 3, 4 FIX) --- */
    .apaar-form-template, .print-form-template {
        max-width: 210mm; 
        margin: 0 auto; 
        padding: 5mm 10mm; /* Issue 2 FIX: Decreased margin for more space */
        box-sizing: border-box;
        background: white;
        font-family: Arial, sans-serif;
    }
    .print-form-template {
        border: 1px solid #000; 
        font-size: 12px;
        line-height: 1.4;
    }
    .print-box {
        border: 1px solid #000;
        padding: 5px;
        margin-bottom: 5px;
        display: flex;
        flex-wrap: wrap;
    }
    .print-field {
        display: flex;
        align-items: flex-end;
        padding: 2px 0;
    }
    .print-label {
        font-weight: bold;
        white-space: nowrap;
        margin-right: 5px;
        font-size: 11px;
    }
    .print-value {
        flex-grow: 1;
        border-bottom: 1px dashed #000;
        min-width: 50px;
        padding: 0 5px;
        font-size: 13px;
    }
    .print-row-group {
        width: 100%;
        display: flex;
        justify-content: space-between;
    }
    .print-col-33 { width: 32%; }
    .print-col-50 { width: 48%; }
    .signature-area {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
        font-size: 10px;
        width: 100%;
    }
    .signature-box {
        width: 30%;
        text-align: center;
        border-top: 1px solid #000;
        padding-top: 5px;
    }
    /* Page break for printing */
    .page-break {
        page-break-before: always;
    }
    /* Register Table Styles */
    .register-table th, .register-table td {
        white-space: nowrap; /* Prevent wrapping in register actions */
    }
    .register-table .action-btn {
        padding: 4px 8px;
        margin: 2px;
        font-size: 12px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
    }
    .register-table .accept { background-color: #28a745; color: white; }
    .register-table .reject { background-color: #ffc107; color: black; }
    .register-table .delete { background-color: #dc3545; color: white; }
</style>

</head>
<body>

<div class="tab-buttons">
    <button class="active" onclick="showTab('admissionFormTab', this)">Admission Form</button>
    <button onclick="showTab('admissionRegisterTab', this)">Admission Register</button>
    <button onclick="alert('Search functionality coming soon!')">Search Student</button>
</div>

<div id="admissionFormTab" class="tab-content active">
    
    <div class="container" id="admissionFormContainer"> 
        
        <div class="header-content" style="margin-top: 5px;"> <div class="school-logo"> [Logo] </div>
            <div class="header-text">
                <h2>GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h2>
                <p>Wagoora Babareshhi Road Near Zonal Education Office Wagoora<br>
                **Email ID: psspethgam@gmail.com. UDISECode: 01022202207**</p>
            </div>
        </div>
        
        <h3 style="text-align:center;">ADMISSION FORM</h3>

        <form id="admissionForm">
            <label>Students Name</label>
            <div class="form-row">
                <div class="form-group"><input type="text" name="sname_first" required><label>First Name</label></div>
                <div class="form-group"><input type="text" name="sname_middle"><label>Middle Name</label></div>
                <div class="form-group"><input type="text" name="sname_last" required><label>Last Name</label></div>
            </div>
            <label>Name As Per Aadhaar</label>
            <div class="form-row">
                <div class="form-group"><input type="text" name="aname_first"><label>First Name</label></div>
                <div class="form-group"><input type="text" name="aname_middle"><label>Middle Name</label></div>
                <div class="form-group"><input type="text" name="aname_last"><label>Last Name</label></div>
            </div>

            <label>Father's Name</label>
            <div class="form-row">
                <div class="form-group"><input type="text" name="fname_first" required><label>First Name</label></div>
                <div class="form-group"><input type="text" name="fname_middle"><label>Middle Name</label></div>
                <div class="form-group"><input type="text" name="fname_last" required><label>Last Name</label></div>
            </div>

            <label>Mother's Name</label>
            <div class="form-row">
                <div class="form-group"><input type="text" name="mname_first" required><label>First Name</label></div>
                <div class="form-group"><input type="text" name="mname_middle"><label>Middle Name</label></div>
                <div class="form-group"><input type="text" name="mname_last" required><label>Last Name</label></div>
            </div>
            
            <div class="form-row">
                <div class="form-group"><label>Residence</label><input type="text" name="residence" required></div>
                <div class="form-group"><label>District</label><input type="text" name="district" required></div>
            </div>
            
            <div class="form-row">
                <div class="form-group"><label>Father's Contact Number</label><input type="text" name="fcontact" required></div>
                <div class="form-group"><label>Mother's Contact Number</label><input type="text" name="mcontact"></div>
            </div>

            <div class="form-row">
                <div class="form-group"><label>Aadhaar Number</label><input type="text" name="aadhaar" maxlength="12"></div>
                <div class="form-group"><label>Date of Birth (in figures)</label><input type="date" name="dob" required></div>
            </div>
            <label>Date of Birth in Words</label>
            <input type="text" name="dob_words">

            <div class="form-row">
                <div class="form-group"><label>Bank Account Number</label><input type="text" name="bank_account"></div>
                <div class="form-group"><label>Bank Name</label><input type="text" name="bank_name"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Bank Branch</label><input type="text" name="bank_branch"></div>
                <div class="form-group"><label>IFSC Code</label><input type="text" name="ifsc_code"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Category</label>
                    <select name="category">
                        <option>SC</option><option>ST</option><option>OBC</option><option>GENERAL</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Blood Group</label>
                    <select name="bloodgroup">
                        <option value="">Select</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                        <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Ration Card Number</label><input type="text" name="ration_no"></div>
                <div class="form-group"><label>Ration Card Type</label><input type="text" name="ration_type"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Class Joining</label>
                    <select name="class" required>
                        <option value="">Select Class</option><option>Nursery</option><option>LKG</option><option>UKG</option>
                        <option>1st</option><option>2nd</option><option>3rd</option><option>4th</option><option>5th</option>
                    </select>
                </div>
                <div class="form-group"><label>PEN Number for Transferring Students</label><input type="text" name="pen_number"></div>
            </div>

            <label>Student Photo</label>
            <input type="file" name="student_photo" accept="image/*">
            
            <p class="section-title">Parents Declaration</p>
            <p style="text-align:justify; font-size:14px;">
                I do hereby declare that the above information provided by me is true to the best of my knowledge and belief. 
                I further declare that I will abide by the rules and regulations laid down by the school and the department from 
                time to time and I will co-operate with the institution for the betterment of my ward and institution under rules 
                when sought. I hereby declare that as the Parent of above mentioned student I am giving my consent to provide 
                the AADHAAR for the demographic authentication of the student.
            </p>

            <label style="margin-top: 15px;">
                <input type="checkbox" id="agree" required>
                I agree to the above declaration.
            </label>

            <div class="form-actions">
                <button type="button" id="openApaarForm">Open APAAR Form</button>
                <button type="submit" class="submit-btn">Submit Admission Form</button>
            </div>
        </form>

        <div class="office-use-box" id="officeUseBox" style="margin-top: 25px;">
            <h3 style="text-align:center; margin-top:0;">OFFICE USE ONLY</h3>
            <label>Admission No. Allotted</label>
            <input type="text" name="allotted_adm_no" placeholder="To be filled by Office">

            <div class="form-row">
                <div class="form-group"><label>Class Admitted To</label><input type="text" name="admitted_class"></div>
                <div class="form-group"><label>Date of Admission</label><input type="date" name="admission_date"></div>
            </div>

            <p style="margin-top:15px;font-weight:bold; font-size:14px;">
                The Student is admitted to Class <span style="text-decoration: underline;">________</span> under Admission No. <span style="text-decoration: underline;">________</span> on <span style="text-decoration: underline;">________</span>. 
                All required documents, including the Birth Certificate, Residence Proof, and Transfer Certificate (if applicable), 
                have been duly verified and found satisfactory.
            </p>

            <div class="form-row" style="margin-top: 30px;">
                <div class="form-group"><input type="text"><label>Signature of Parent</label></div>
                <div class="form-group"><input type="text"><label>Sig. Of Adm. Incharge</label></div>
                <div class="form-group"><input type="text"><label>Sig. Of Headmaster</label></div>
            </div>
        </div>
    </div>

    <div class="container" style="margin-top: 20px;">
        <p style="text-align: center; font-weight: bold; margin-bottom: 10px;">Download Options (Use after successful data submission)</p>
        <div class="action-buttons">
            <button id="downloadForm" class="pdf-btn" data-target="printFormTemplate">Download Printable Admission Form (Hard Copy)</button>
            <button id="downloadRegister" class="pdf-btn" data-target="officeUseBox">Download PDF Register Record</button>
            <button id="downloadApaar" class="pdf-btn">Download APAAR Consent Form</button>
        </div>
    </div>
</div>

<div id="admissionRegisterTab" class="tab-content">
    <div class="container">
        <h3 style="text-align:center;">ADMITTED STUDENT REGISTER</h3>
        <p style="font-weight: bold;">Filter by Status: 
            <select id="statusFilter" onchange="filterRegister()">
                <option value="All">All</option><option value="Admitted">Admitted</option>
                <option value="In Progress">In Progress</option>
            </select>
        </p>

        <div style="max-height: 500px; overflow-y: auto;">
            <table class="register-table">
                <thead>
                    <tr>
                        <th>S.No</th><th>Date of Submission</th><th>Student Name</th><th>DOB</th>
                        <th>Father's Name</th><th>Class Joining</th><th>Parents Contact</th>
                        <th>Status</th><th>Actions</th>
                    </tr>
                </thead>
                <tbody id="registerBody">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<div id="printFormTemplate" class="print-form-template" style="display: none;">
    <div class="header-content" style="border-bottom: none; padding-bottom: 5px; margin-top: 0;"> 
        <div class="school-logo" style="height: 50px; width: 50px;"> [Logo] </div>
        <div class="header-text" style="text-align: center;">
            <h3 style="color: #000; margin-bottom: 0; font-size: 16px;">GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h3>
            <p style="font-size: 10px;">Wagoora Babareshhi Road Near Zonal Education Office Wagoora. UDISE Code: 01022202207</p>
        </div>
    </div>
    <h3 style="text-align:center; margin-top:0; font-size: 18px;">ADMISSION FORM</h3>
    
    <div class="print-box">
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-33"><span class="print-label">Students Name:</span><span class="print-value" data-field="sname_first"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="sname_middle"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="sname_last"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-33"><span class="print-label">Name As Per Aadhaar:</span><span class="print-value" data-field="aname_first"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="aname_middle"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="aname_last"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-33"><span class="print-label">Father's Name:</span><span class="print-value" data-field="fname_first"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="fname_middle"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="fname_last"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-33"><span class="print-label">Mother's Name:</span><span class="print-value" data-field="mname_first"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="mname_middle"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="mname_last"></span></div>
        </div>
    </div>

    <div class="print-box">
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Residence:</span><span class="print-value" data-field="residence"></span></div>
            <div class="print-field print-col-50"><span class="print-label">District:</span><span class="print-value" data-field="district"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Father's Contact Number:</span><span class="print-value" data-field="fcontact"></span></div>
            <div class="print-field print-col-50"><span class="print-label">Mother's Contact Number:</span><span class="print-value" data-field="mcontact"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"</head>
<body>

<div class="tab-buttons">
    <button class="active" onclick="showTab('admissionFormTab', this)">Admission Form</button>
    <button onclick="showTab('admissionRegisterTab', this)">Admission Register</button>
    <button onclick="alert('Search functionality coming soon!')">Search Student</button>
</div>

<div id="admissionFormTab" class="tab-content active">
    
    <div class="container" id="admissionFormContainer"> 
        
        <div class="header-content">
            <div class="school-logo"> [Logo] </div>
            <div class="header-text">
                <h2>GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h2>
                <p>Wagoora Babareshhi Road Near Zonal Education Office Wagoora<br>
                **Email ID: psspethgam@gmail.com. UDISECode: 01022202207**</p>
            </div>
        </div>
        
        <h3 style="text-align:center;">ADMISSION FORM</h3>

        <form id="admissionForm">
            <label>Students Name</label>
            <div class="form-row">
                <div class="form-group"><input type="text" name="sname_first" required><label>First Name</label></div>
                <div class="form-group"><input type="text" name="sname_middle"><label>Middle Name</label></div>
                <div class="form-group"><input type="text" name="sname_last" required><label>Last Name</label></div>
            </div>

            <label>Name As Per Aadhaar</label>
            <div class="form-row">
                <div class="form-group"><input type="text" name="aname_first"><label>First Name</label></div>
                <div class="form-group"><input type="text" name="aname_middle"><label>Middle Name</label></div>
                <div class="form-group"><input type="text" name="aname_last"><label>Last Name</label></div>
            </div>

            <label>Father's Name</label>
            <div class="form-row">
                <div class="form-group"><input type="text" name="fname_first" required><label>First Name</label></div>
                <div class="form-group"><input type="text" name="fname_middle"><label>Middle Name</label></div>
                <div class="form-group"><input type="text" name="fname_last" required><label>Last Name</label></div>
            </div>

            <label>Mother's Name</label>
            <div class="form-row">
                <div class="form-group"><input type="text" name="mname_first" required><label>First Name</label></div>
                <div class="form-group"><input type="text" name="mname_middle"><label>Middle Name</label></div>
                <div class="form-group"><input type="text" name="mname_last" required><label>Last Name</label></div>
            </div>
            
            <div class="form-row">
                <div class="form-group"><label>Residence</label><input type="text" name="residence" required></div>
                <div class="form-group"><label>District</label><input type="text" name="district" required></div>
            </div>
            
            <div class="form-row">
                <div class="form-group"><label>Father's Contact Number</label><input type="text" name="fcontact" required></div>
                <div class="form-group"><label>Mother's Contact Number</label><input type="text" name="mcontact"></div>
            </div>

            <div class="form-row">
                <div class="form-group"><label>Aadhaar Number</label><input type="text" name="aadhaar" maxlength="12"></div>
                <div class="form-group"><label>Date of Birth (in figures)</label><input type="date" name="dob" required></div>
            </div>
            <label>Date of Birth in Words</label>
            <input type="text" name="dob_words">

            <div class="form-row">
                <div class="form-group"><label>Bank Account Number</label><input type="text" name="bank_account"></div>
                <div class="form-group"><label>Bank Name</label><input type="text" name="bank_name"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Bank Branch</label><input type="text" name="bank_branch"></div>
                <div class="form-group"><label>IFSC Code</label><input type="text" name="ifsc_code"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Category</label>
                    <select name="category">
                        <option>SC</option><option>ST</option><option>OBC</option><option>GENERAL</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Blood Group</label>
                    <select name="bloodgroup">
                        <option value="">Select</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                        <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Ration Card Number</label><input type="text" name="ration_no"></div>
                <div class="form-group"><label>Ration Card Type</label><input type="text" name="ration_type"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Class Joining</label>
                    <select name="class" required>
                        <option value="">Select Class</option><option>Nursery</option><option>LKG</option><option>UKG</option>
                        <option>1st</option><option>2nd</option><option>3rd</option><option>4th</option><option>5th</option>
                    </select>
                </div>
                <div class="form-group"><label>PEN Number for Transferring Students</label><input type="text" name="pen_number"></div>
            </div>

            <label>Student Photo</label>
            <input type="file" name="student_photo" accept="image/*">
            
            <p class="section-title">Parents Declaration</p>
            <p style="text-align:justify; font-size:14px;">
                I do hereby declare that the above information provided by me is true to the best of my knowledge and belief. 
                I further declare that I will abide by the rules and regulations laid down by the school and the department from 
                time to time and I will co-operate with the institution for the betterment of my ward and institution under rules 
                when sought. I hereby declare that as the Parent of above mentioned student I am giving my consent to provide 
                the AADHAAR for the demographic authentication of the student.
            </p>

            <label style="margin-top: 15px;">
                <input type="checkbox" id="agree" required>
                I agree to the above declaration.
            </label>

            <button type="submit" class="submit-btn">Submit Admission Form & Proceed to APAAR</button>
        </form>

        <div class="office-use-box" id="officeUseBox" style="margin-top: 25px;">
            <h3 style="text-align:center; margin-top:0;">OFFICE USE ONLY</h3>
            <label>Admission No. Allotted</label>
            <input type="text" name="allotted_adm_no" placeholder="To be filled by Office">

            <div class="form-row">
                <div class="form-group"><label>Class Admitted To</label><input type="text" name="admitted_class"></div>
                <div class="form-group"><label>Date of Admission</label><input type="date" name="admission_date"></div>
            </div>

            <p style="margin-top:15px;font-weight:bold; font-size:14px;">
                The Student is admitted to Class <span style="text-decoration: underline;">________</span> under Admission No. <span style="text-decoration: underline;">________</span> on <span style="text-decoration: underline;">________</span>. 
                All required documents, including the Birth Certificate, Residence Proof, and Transfer Certificate (if applicable), 
                have been duly verified and found satisfactory.
            </p>

            <div class="form-row" style="margin-top: 30px;">
                <div class="form-group"><input type="text"><label>Signature of Parent</label></div>
                <div class="form-group"><input type="text"><label>Sig. Of Adm. Incharge</label></div>
                <div class="form-group"><input type="text"><label>Sig. Of Headmaster</label></div>
            </div>
        </div>
    </div>

    <div class="container" style="margin-top: 20px;">
        <p style="text-align: center; font-weight: bold; margin-bottom: 10px;">Download Options (Use after Submission)</p>
        <div class="action-buttons">
            <button id="downloadForm" class="pdf-btn" data-target="printFormTemplate">Download Printable Admission Form (Hard Copy)</button>
            <button id="downloadRegister" class="pdf-btn" data-target="officeUseBox">Download PDF Register Record</button>
            <button id="downloadApaar" class="pdf-btn">Download APAAR Form</button>
        </div>
    </div>
</div>

<div id="admissionRegisterTab" class="tab-content">
    <div class="container">
        <h3 style="text-align:center;">ADMITTED STUDENT REGISTER</h3>
        <p style="font-weight: bold;">Filter by Status: 
            <select id="statusFilter" onchange="filterRegister()">
                <option value="All">All</option><option value="Admitted">Admitted</option>
                <option value="In Progress">In Progress</option>
            </select>
        </p>

        <div style="max-height: 500px; overflow-y: auto;">
            <table class="register-table">
                <thead>
                    <tr>
                        <th>S.No</th><th>Date of Admission</th><th>Student Name</th><th>DOB</th>
                        <th>Father's Name</th><th>Mother's Name</th><th>Parents Contact</th>
                        <th>Parents Profession</th><th>Status of Admission</th><th>Photo</th><th>Remarks</th>
                    </tr>
                </thead>
                <tbody id="registerBody">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<div id="printFormTemplate" class="print-form-template" style="display: none;">
    <div class="header-content" style="border-bottom: none; padding-bottom: 5px;">
        <div class="school-logo" style="height: 50px; width: 50px;"> [Logo] </div>
        <div class="header-text" style="text-align: center;">
            <h3 style="color: #000; margin-bottom: 0; font-size: 16px;">GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h3>
            <p style="font-size: 10px;">Wagoora Babareshhi Road Near Zonal Education Office Wagoora. UDISE Code: 01022202207</p>
        </div>
    </div>
    <h3 style="text-align:center; margin-top:0; font-size: 18px;">ADMISSION FORM</h3>
    
    <div class="print-box">
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-33"><span class="print-label">Students Name:</span><span class="print-value" data-field="sname_first"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="sname_middle"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="sname_last"></span></div>
            <span style="width: 100%; display: flex; justify-content: space-around; font-size: 9px; margin-top: 2px;"><span>First Name</span><span>Middle Name</span><span>Last Name</span></span>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-33"><span class="print-label">Name As Per Aadhaar:</span><span class="print-value" data-field="aname_first"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="aname_middle"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="aname_last"></span></div>
            <span style="width: 100%; display: flex; justify-content: space-around; font-size: 9px; margin-top: 2px;"><span>First Name</span><span>Middle Name</span><span>Last Name</span></span>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-33"><span class="print-label">Father's Name:</span><span class="print-value" data-field="fname_first"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="fname_middle"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="fname_last"></span></div>
            <span style="width: 100%; display: flex; justify-content: space-around; font-size: 9px; margin-top: 2px;"><span>First Name</span><span>Middle Name</span><span>Last Name</span></span>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-33"><span class="print-label">Mother's Name:</span><span class="print-value" data-field="mname_first"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="mname_middle"></span></div>
            <div class="print-field print-col-33"><span class="print-label"></span><span class="print-value" data-field="mname_last"></span></div>
            <span style="width: 100%; display: flex; justify-content: space-around; font-size: 9px; margin-top: 2px;"><span>First Name</span><span>Middle Name</span><span>Last Name</span></span>
        </div>
    </div>

    <div class="print-box">
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Residence:</span><span class="print-value" data-field="residence"></span></div>
            <div class="print-field print-col-50"><span class="print-label">District:</span><span class="print-value" data-field="district"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Father's Contact Number:</span><span class="print-value" data-field="fcontact"></span></div>
            <div class="print-field print-col-50"><span class="print-label">Mother's Contact Number:</span><span class="print-value" data-field="mcontact"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Aadhaar Number:</span><span class="print-value" data-field="aadhaar"></span></div>
            <div class="print-field print-col-50"><span class="print-label">Date of Birth (in figures):</span><span class="print-value" data-field="dob"></span></div>
        </div>
        <div class="print-field" style="width: 100%; margin-bottom: 10px;"><span class="print-label">Date of Birth in Words:</span><span class="print-value" data-field="dob_words"></span></div>
    </div>

    <div class="print-box">
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Bank Account Number:</span><span class="print-value" data-field="bank_account"></span></div>
            <div class="print-field print-col-50"><span class="print-label">Bank Name:</span><span class="print-value" data-field="bank_name"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Bank Branch:</span><span class="print-value" data-field="bank_branch"></span></div>
            <div class="print-field print-col-50"><span class="print-label">IFSC Code:</span><span class="print-value" data-field="ifsc_code"></span></div>
        </div>
    </div>

    <div class="print-box">
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Category:</span><span class="print-value" data-field="category" style="width: auto;"></span></div>
            <div class="print-field print-col-50"><span class="print-label">Blood Group:</span><span class="print-value" data-field="bloodgroup" style="width: auto;"></span></div>
        </div>
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Ration Card Number:</span><span class="print-value" data-field="ration_no"></span></div>
            <div class="print-field print-col-50"><span class="print-label">Ration Card Type:</span><span class="print-value" data-field="ration_type"></span></div>
        </div>
    </div>
    
    <div class="print-box">
        <div class="print-row-group" style="margin-bottom: 10px;">
            <div class="print-field print-col-50"><span class="print-label">Class Joining:</span><span class="print-value" data-field="class"></span></div>
            <div class="print-field print-col-50"><span class="print-label">PEN Number for Transferring Students:</span><span class="print-value" data-field="pen_number"></span></div>
        </div>
    </div>

    <h4 style="margin-top: 15px; margin-bottom: 5px; text-decoration: underline;">Parents Declaration</h4>
    <p style="text-align:justify; font-size:11px;">
        I do hereby declare that the above information provided by me is true to the best of my knowledge and belief. 
        I further declare that I will abide by the rules and regulations laid down by the school and the department from 
        time to time and I will co-operate with the institution for the betterment of my ward and institution under rules 
        when sought. I hereby declare that as the Parent of above mentioned student I am giving my consent to provide 
        the AADHAAR for the demographic authentication of the student. (Agreed: <span data-field="agree" style="font-weight: bold;"></span>)
    </p>

    <h4 style="margin-top: 15px; margin-bottom: 5px; text-decoration: underline;">For Office Use Only</h4>
    <p style="font-size: 11px;">The Student is admitted to Class <span class="print-value" style="min-width: 50px;">________</span> under Admission No. <span class="print-value" style="min-width: 50px;">________</span> on <span class="print-value" style="min-width: 70px;">________</span>. 
        All required documents, including the Birth Certificate, Residence Proof, and Transfer Certificate (if applicable), have been duly verified and found satisfactory.</p>


    <div class="signature-area">
        <div class="signature-box">Signature of Parent</div>
        <div class="signature-box">Sig. Of Adm. Incharge</div>
        <div class="signature-box">Sig. Of Headmaster</div>
    </div>

</div>


<div id="apaarTemplate" class="apaar-form-template" style="display: none; border: 1px solid #000;">
    <div class="header-content" style="border-bottom: none;">
        <div class="school-logo" style="height: 50px; width: 50px;"> [Logo] </div>
        <div class="header-text" style="text-align: center;">
            <h3 style="color: #000; margin-bottom: 0; font-size: 14px;">GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h3>
            <p style="font-size: 10px;">Wagoora Babareshhi Road Near Zonal Education Office Wagoora. UDISE Code: 01022202207</p>
        </div>
    </div>
    <h3 style="margin-top: 10px;">Consent by Father/Mother/Legal Guardian of Student for APAAR ID Generation</h3>
    <p style="font-size: 11px;">Consent by Father/Mother/Legal Guardian of <span class="print-value" style="min-width: 200px;" data-field="sname_full">...</span> as the <span class="print-value" style="min-width: 100px;" data-field="fname_full">...</span> (Father / Mother / Legal Guardian) of <span class="print-value" style="min-width: 50px;">...</span> (Aadhaar / PAN / EPIC Voter ID / Driving License / Passport) and identity Proof Number <span class="print-value" style="min-width: 100px;" data-field="aadhaar">...</span> voluntarily give my consent to share his/her Aadhaar Number and demographic information issued by UIDAI with Ministry of Education for the sole purpose of creation of APAAR ID and opening of DIGILOCKER account of my child for the following intents and purposes.</p>
    <p style="font-size: 11px;">I understand that my APAAR ID may be used for limited purposes as may be notified by Ministry of Education from time-to-time for educational and related activities. Further I am also aware that my personal identifiable information (Name, Address, Age, Date of Birth, Gender and Photograph) may be made available to entities engaged in various educational activities such as UDISE+ database, scholarships, maintenance academic records, other stakeholders like Educational Institutions and recruitment agencies.</p>
    <p style="font-size: 11px;">I authorise Ministry of Education to use my Aadhaar number for performing Aadhaar based authentication with UIDAI as per provision of the Aadhaar (Targeted Delivery of Financial and Other Subsidies, Benefits, and Services) Act, 2016 for the aforesaid purpose. I understand that UIDAI will share my e-KYC details, or response of "Yes" with Ministry of Education upon successful authentication.</p>
    <p style="font-size: 11px;">I understand that the information shared by me shall be kept **Confidential** and shall not be divulged to any third party except as may be required by law.</p>
    <p style="font-size: 11px;">I understand that I can withdraw my consent for all or any of the purposes at any time by and on withdrawal of my consent, the processing of my shared information will stop, however, any personal data already been processed shall remain unaffected on such withdrawal of consent.</p>

    <div style="display: flex; justify-content: space-between; margin-top: 30px; font-size: 11px;">
        <div>Place of Physical Consent: <span class="print-value" style="min-width: 150px;" data-field="district">...</span></div>
        <div>Signature or Parent Guardian: <span class="print-value" style="min-width: 150px;"></span></div>
    </div>
    <div style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 11px;">
        <div>Date of Physical Consent: <span class="print-value" style="min-width: 150px;">...</span></div>
        <div></div>
    </div>
    
    <p style="text-align: center; margin: 20px 0; font-weight: bold;">********************Consent by Head of the School********************</p>
    <p style="font-size: 11px;">I **Mohmad Ashraf Rather** as Head of the School or any authorized teacher/staff hereby declare that the Father/Mother/Legal Guardian of <span class="print-value" style="min-width: 200px;" data-field="sname_full">...</span> as mentioned above has given the Consent for Providing AADHAAR to create APAAR ID, opening of DIGILOCKER Account and Identity Verification in UDISE Plus Date:</p>

    <div style="display: flex; justify-content: space-between; margin-top: 30px; font-size: 11px;">
        <div style="padding-top: 5px; min-width: 100px;">Date: <span class="print-value" style="min-width: 100px;"></span></div>
        <div style="border-top: 1px solid #000; padding-top: 5px; min-width: 150px; text-align: center;">Signature of HoI</div>
    </div>
</div>


<script>
    const { jsPDF } = window.jspdf;
    let admittedStudents = []; 

    // --- Tab Switching Logic ---
    function showTab(tabId, button) {
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.querySelectorAll('.tab-buttons button').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        button.classList.add('active');
    }

    // --- Data Extraction ---
    function extractFormDataForPDF(formId) {
        const form = document.getElementById(formId);
        const data = {};
        const elements = form.querySelectorAll('input, select, textarea');

        elements.forEach(element => {
            if (element.name && element.name !== 'agree') {
                if (element.type === 'checkbox') {
                    data[element.name] = element.checked ? 'Yes' : 'No';
                } else if (element.type === 'file') {
                    data[element.name] = 'File uploaded'; 
                } else if (element.tagName === 'SELECT' && element.options[element.selectedIndex]) {
                    data[element.name] = element.options[element.selectedIndex].text;
                } else {
                    data[element.name] = element.value;
                }
            }
        });
        data['agree'] = form.querySelector('#agree') ? (form.querySelector('#agree').checked ? 'Agreed' : 'Not Agreed') : 'N/A';
        // Concatenated fields
        data['sname_full'] = `${data.sname_first || ''} ${data.sname_middle || ''} ${data.sname_last || ''}`.trim().replace(/\s+/g, ' ');
        data['fname_full'] = `${data.fname_first || ''} ${data.fname_middle || ''} ${data.fname_last || ''}`.trim().replace(/\s+/g, ' ');

        return data;
    }
    
    // --- PDF Template Creation FIX (Issue 2) ---
    // Creates a static HTML copy that mimics the form layout using static text and borders.
    function createPrintableContent(elementId, formData) {
        const originalElement = document.getElementById(elementId);
        const clone = originalElement.cloneNode(true);
        clone.id = 'tempPdfContent_' + elementId;
        clone.style.display = 'block'; // Ensure it's visible for canvas capture

        // Fill in the static lines with form data
        clone.querySelectorAll('[data-field]').forEach(span => {
            const fieldName = span.getAttribute('data-field');
            span.textContent = formData[fieldName] || '____________________'; 
        });

        document.body.appendChild(clone);
        return clone;
    }


    /**
     * Generates PDF with correct A4 scaling and template selection.
     */
    function generatePDF(elementId, fileName) {
        if (admittedStudents.length === 0) {
            alert("Error: Please submit the Admission Form first before attempting to download any pre-filled forms.");
            return;
        }

        const formData = admittedStudents[admittedStudents.length - 1].raw_data;
        
        let elementToCapture;
        
        if (elementId === 'printFormTemplate' || elementId === 'apaarTemplate') {
            elementToCapture = createPrintableContent(elementId, formData);
        } else {
            // For Office Use Box/Register Record (original structure is fine)
            elementToCapture = document.getElementById(elementId);
        }

        html2canvas(elementToCapture, { 
            scale: 3, 
            allowTaint: true,
            useCORS: true 
        }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4'); 

            const pdfWidth = 210; 
            const pdfHeight = 297; 
            
            const imgHeight = canvas.height * pdfWidth / canvas.width;
            
            let heightLeft = imgHeight;
            let position = 0;

            // Add first page
            pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeight);
            heightLeft -= pdfHeight;

            // Handle multi-page content
            while (heightLeft > 0) {
                position = heightLeft - imgHeight; 
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeight);
                heightLeft -= pdfHeight;
            }

            pdf.save(fileName);
        }).finally(() => {
            // Clean up the temporary content
            if (elementToCapture && elementToCapture.id.startsWith('tempPdfContent_')) {
                elementToCapture.remove();
            }
        });
    }

    // --- Submission Logic (Issue 1 FIX: Proceed to Register/Downloads) ---
    document.getElementById("admissionForm").addEventListener("submit", function(e){
        e.preventDefault();
        
        const form = e.target;
        const formData = extractFormDataForPDF(form.id);
        
        // Prepare data for Register 
        const date = new Date().toISOString().slice(0, 10);
        const newRecord = {
            sno: admittedStudents.length + 1,
            dateOfAdmission: date,
            studentName: formData.sname_full,
            dob: formData.dob,
            fatherName: formData.fname_full,
            motherName: `${formData.mname_first} ${formData.mname_last}`, 
            parentsContact: formData.fcontact,
            parentsProfession: 'N/A', 
            status: 'In Progress', 
            photo: 'placeholder',
            remarks: 'Submitted waiting for verification.',
            raw_data: formData 
        };

        admittedStudents.push(newRecord);
        updateRegisterTable();
        
        // FIX: Instead of alerting a simulation, switch to the Register tab
        // and notify the user to use the download buttons.
        alert(`Admission Form submitted successfully. Student: ${newRecord.studentName} added to the Admission Register.\n\nAPAAR Form is now generated and ready for download via the "Download APAAR Form" button.`);
        
        // FIX: Switch to the Admission Register tab after submission
        showTab('admissionRegisterTab', document.querySelector('.tab-buttons button:nth-child(2)'));

        form.reset();
    });

    // --- Register Table Logic ---
    function updateRegisterTable() {
        const body = document.getElementById('registerBody');
        body.innerHTML = ''; 

        // Initial Sample Data (Only add samples if the array is empty)
        if (admittedStudents.length === 0) {
             admittedStudents.push({
                sno: 1, dateOfAdmission: '2025-07-01', studentName: 'Ayesha Bhat', dob: '2019-01-15', fatherName: 'Ghulam Mohd Bhat', motherName: 'Zehra Begum', parentsContact: '9876543210', parentsProfession: 'Teacher', status: 'Admitted', photo: 'placeholder', remarks: 'TC received.', raw_data: {}
            });
            admittedStudents.push({
                sno: 2, dateOfAdmission: '', studentName: 'Danish Lone', dob: '2020-05-20', fatherName: 'Abdul Ahad Lone', motherName: 'Fatima Jan', parentsContact: '9988776655', parentsProfession: 'Farmer', status: 'In Progress', photo: 'placeholder', remarks: 'Aadhaar pending.', raw_data: {}
            });
        }

        admittedStudents.forEach(record => {
            const row = body.insertRow();
            row.setAttribute('data-status', record.status);
            
            row.insertCell().textContent = record.sno;
            row.insertCell().textContent = record.dateOfAdmission;
            row.insertCell().textContent = record.studentName;
            row.insertCell().textContent = record.dob;
            row.insertCell().textContent = record.fatherName;
            row.insertCell().textContent = record.motherName;
            row.insertCell().textContent = record.parentsContact;
            row.insertCell().textContent = record.parentsProfession;
            
            const statusCell = row.insertCell();
            statusCell.textContent = record.status;
            statusCell.style.color = record.status === 'Admitted' ? 'green' : 'orange';

            const photoCell = row.insertCell();
            photoCell.innerHTML = '<img style="width: 24px; height: 24px;" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDExQzE0LjIwOTEgMTQgMTQuOSA5LjggMTUgMTJDLTEuNjY2NjcgMTIgOS4yNDY4NyAxMiAxMiAxM1oiIHN0cm9rZT0iIzMyMzIzMiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI5IiBzdHJva2U9IiMzMjMyMzIiIHN0cm9rZS13aWR0aD0iMS41Ii8+Cjwvc3ZnPgo=" alt="Photo" />';

            row.insertCell().textContent = record.remarks;
        });
        filterRegister();
    }

    function filterRegister() {
        const filterValue = document.getElementById('statusFilter').value;
        const rows = document.getElementById('registerBody').getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const status = rows[i].getAttribute('data-status');
            if (filterValue === 'All' || status === filterValue) {
                rows[i].style.display = '';
            } else {
                rows[i].style.display = 'none';
            }
        }
    }

    // --- PDF Event Listeners FIX ---
    document.getElementById("downloadForm").addEventListener("click", function(){
        generatePDF('printFormTemplate', 'Admission_Form_Hard_Copy.pdf');
    });

    document.getElementById("downloadRegister").addEventListener("click", function(){
        generatePDF('officeUseBox', 'Admission_Register_Record.pdf');
    });
    
    document.getElementById("downloadApaar").addEventListener("click", function(){
        generatePDF('apaarTemplate', 'APAAR_Consent_Form.pdf');
    });

    // Initialize the Register table and show the default tab
    updateRegisterTable(); 
    showTab('admissionFormTab', document.querySelector('.tab-buttons button:first-child'));

</script>

</body>
</html>









             
