<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MDM Monthly Expenditure Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Styles tailored for PDF printing */
        .pdf-container {
            width: 210mm; /* A4 width for printing */
            min-height: 297mm; /* A4 height */
            padding: 15mm;
            margin: 0 auto;
            background-color: white;
            font-family: Arial, sans-serif;
            font-size: 10pt;
            border: 1px solid #ccc;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        th, td {
            border: 1px solid #000;
            padding: 5px;
            text-align: left;
        }
        .header-section {
            text-align: center;
            margin-bottom: 20px;
        }
        .header-section h2 {
            font-size: 14pt;
            margin-bottom: 5px;
        }
        .input-group label {
            font-weight: bold;
        }
        @media print {
            .input-group, .controls { display: none; }
            .pdf-container { border: none; }
        }
    </style>
</head>
<body>
    <div class="pdf-container" id="mdmExpenditureTemplate">
        <div class="header-section">
            <h2>MID-DAY MEAL (MDM) MONTHLY EXPENDITURE REPORT</h2>
            <p>GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</p>
            <p>UDISE: 01022202207</p>
            <p>Month: <span id="report-month-year" class="fw-bold">[Input: Month & Year]</span></p>
        </div>

        <div class="row mb-3">
            <div class="col-6">Enrollment (Primary): <span id="report-enrollment" class="fw-bold">0</span></div>
            <div class="col-6 text-end">Date Generated: <span id="report-date"></span></div>
        </div>

        <h4 style="font-size: 12pt;">A. Commodities Received/Used (Cumulative)</h4>
        <table>
            <thead>
                <tr>
                    <th>Commodity</th>
                    <th>Opening Balance (Kg/L)</th>
                    <th>Received (Kg/L)</th>
                    <th>Consumed (Kg/L)</th>
                    <th>Closing Balance (Kg/L)</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Rice</td><td class="c-ob">0</td><td class="c-rec">0</td><td class="c-con">0</td><td class="c-cb">0</td></tr>
                <tr><td>Oil</td><td class="c-ob">0</td><td class="c-rec">0</td><td class="c-con">0</td><td class="c-cb">0</td></tr>
                <tr><td>Pulses (Dal)</td><td class="c-ob">0</td><td class="c-rec">0</td><td class="c-con">0</td><td class="c-cb">0</td></tr>
                </tbody>
        </table>

        <h4 style="font-size: 12pt;">B. Expenditure Details (Cooking Cost)</h4>
        <table>
            <thead>
                <tr>
                    <th>Expense Head</th>
                    <th>Amount Spent (₹)</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Cost of Vegetables/Meat/Eggs</td><td class="e-amount">0.00</td><td></td></tr>
                <tr><td>Cost of Fuel (Wood/Gas)</td><td class="e-amount">0.00</td><td></td></tr>
                <tr><td>Cost of Condiments/Spices</td><td class="e-amount">0.00</td><td></td></tr>
                <tr><td>Labor/Honorarium (Cook)</td><td class="e-amount">0.00</td><td></td></tr>
                <tr><td colspan="3" style="text-align: right; font-weight: bold;">GRAND TOTAL (₹): <span id="grand-total-exp">0.00</span></td></tr>
            </tbody>
        </table>

        <p class="mt-4">Certified that the above figures are correct and based on actual registers maintained at the school level.</p>
        
        <div class="row mt-5">
            <div class="col-6 text-center">
                <br><br>
                **Sign. of Cook-cum-Helper**
            </div>
            <div class="col-6 text-center">
                **Mohammad Ashraf Rather**<br>
                **Head Teacher, GPS Pethgam Wagoora**<br>
                (Official Seal)
            </div>
        </div>
    </div>

    <div class="container mt-4 controls">
        <h4>MDM Report Inputs</h4>
        <div class="row mb-3">
            <div class="col-md-3 input-group"><label>Month & Year:</label><input type="month" id="input-month-year" class="form-control"></div>
            <div class="col-md-3 input-group"><label>Enrollment:</label><input type="number" id="input-enrollment" class="form-control" value="0"></div>
            <div class="col-md-6 input-group"><button class="btn btn-warning 3d-button w-100" id="fill-mdm-data">Load/Fill Template</button></div>
        </div>
        <div class="row">
             <div class="col-md-6"><label>Vegetables/Meat Cost:</label><input type="number" step="0.01" class="form-control expense-input" data-target="0" value="0.00"></div>
             <div class="col-md-6"><label>Fuel Cost:</label><input type="number" step="0.01" class="form-control expense-input" data-target="1" value="0.00"></div>
             <div class="col-md-6"><label>Condiments Cost:</label><input type="number" step="0.01" class="form-control expense-input" data-target="2" value="0.00"></div>
             <div class="col-md-6"><label>Labor Cost:</label><input type="number" step="0.01" class="form-control expense-input" data-target="3" value="0.00"></div>
        </div>
        <button class="btn btn-danger 3d-button my-3 w-100" onclick="generatePDF('mdmExpenditureTemplate', 'MDM_Report.pdf')">Generate PDF</button>
    </div>

    <script src="https://kit.fontawesome.com/your-font-awesome-kit-id.js" crossorigin="anonymous"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="../script.js"></script>
    <script>
        document.getElementById('report-date').textContent = new Date().toLocaleDateString();

        document.getElementById('fill-mdm-data').addEventListener('click', () => {
            document.getElementById('report-month-year').textContent = document.getElementById('input-month-year').value;
            document.getElementById('report-enrollment').textContent = document.getElementById('input-enrollment').value;
            updateExpenditure();
        });

        const expenseInputs = document.querySelectorAll('.expense-input');
        expenseInputs.forEach(input => {
            input.addEventListener('input', updateExpenditure);
        });

        function updateExpenditure() {
            let total = 0;
            const rows = document.querySelectorAll('table:nth-of-type(2) tbody tr');
            
            expenseInputs.forEach(input => {
                const amount = parseFloat(input.value) || 0;
                const targetIndex = parseInt(input.getAttribute('data-target'));
                if (rows[targetIndex]) {
                    rows[targetIndex].querySelector('.e-amount').textContent = amount.toFixed(2);
                    total += amount;
                }
            });

            document.getElementById('grand-total-exp').textContent = total.toFixed(2);
        }
    </script>
</body>
</html>
